<div class="banner" style="height: 10px;background-image: linear-gradient(rgba(0,0,0,0.4),rgba(0,0,0,0.4)), url(https://www.irishtimes.com/polopoly_fs/1.3484190.1525432416!/image/image.jpg_gen/derivatives/box_620_330/image.jpg);">
  <div class="container" data-controller="autocomplete">
    <form action="/results">
      <div class="search-group">
        <div class="">
          <input placeholder="Search for a subject" autocomplete="off" data-target='autocomplete.input' data-action="keyup->autocomplete#suggest" type="text" name="query" id="search" value="<%= params[:query] %>">
          <ul data-target='autocomplete.suggestions' id="display-sugg" class="">
          </ul>
        </div>
        <div class="">
          <button class="btn btn-flat ml-2 reults-btn" type="submit"> Search </button>
        </div>
      </div>
    </form>
  </div>
</div>

<div style="box-shadow: 0 0 15px rgba(0,0,0,0.2);" class="container bg-light">
  <div class="row">

    <div  class="col-2 p-3 text-center <%= ' low-bar'if params[:type].present? %>">
      <%= link_to 'Students', results_path(type: 'student', query: params[:query]) %>
    </div>
    <div class="col-2 text-center p-3<%= ' low-bar'if params[:query] &&  !params[:city].present? &&  !params[:type].present? %>">
      <%= link_to 'Mentors', results_path( query: params[:query])   %>
    </div>
    <div class="col-2 text-center p-3 <%= ' low-bar'if params[:city].present?  %>">
      <% if user_signed_in? %>
      <%= link_to 'In my city', results_path(request.params.merge(city: current_user.location))   %>
      <% end %>
    </div>
    <div style="display: flex; justify-content: space-around;" class="col text-right p-3">
      <div class="dropdown">
        <a class="dropdown-toggle" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Languages
        </a>
        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
          <% User.languages_from_search(@users).each do |language| %>
            <%= link_to language, results_path(request.params.merge(language: language)), class: 'dropdown-item'   %>
          <% end %>
  </div>
</div>
      <% if !params[:type] %>
      <div class="dropdown">
        <a class="dropdown-toggle" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Price
        </a>
        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
          <%= link_to 'Lowest first', results_path(request.params.merge(price: 'low_first')), class: 'dropdown-item'   %>
          <%= link_to 'Highest first', results_path(request.params.merge(price: 'highest_first')), class: 'dropdown-item'   %>
        </div>
</div>
      <% end %>
    </div>
  </div>

  <div class="row my-4">
    <% if  params[:query].blank? || @users.count == 0 %>
        <h4 class="col-12 text-center">
          <% if params[:query] == '' %>
            Please be sure to search for at least one subject
          <% else %>
           Looks like we couldn't find anything for <strong><%= params[:query] if present? %></strong> </h4>
           <% end %>
        <div class="col-12 text-center my-5">
          <img src="https://image.flaticon.com/icons/svg/2353/2353678.svg" width="200" alt="">
        </div>
    <% else %>
    <% @users.each do |u| %>
        <div class="col-10 my-2 mx-auto">
          <div class="card-user">
            <div class="card-top-part">
              <div class="card-left text-center">
                <% if u.photo.attached? %>
                  <%= cl_image_tag u.photo.key, crop: :thumb, gravity: :face, width: 120, height: 120, class: "rounded-circle dropdown-toggle", id: "navbarDropdown", data: { toggle: "dropdown" }, 'aria-haspopup': true, 'aria-expanded': false  %>
                <% else %>
                 <img src="https://image.flaticon.com/icons/svg/847/847969.svg" width="120" class="rounded-circle dropdown-toggle", id="navbarDropdown", data-toggle="dropdown", aria-haspopup="true", aria-expanded="false"  >
                <% end %>
                <%= link_to 'Get help', profile_path(u), class: 'btn btn-flat mt-4' %>
              </div>
              <div class="card-right ml-4">
                <h3> <strong><%= u.full_name  %></strong> </h3>
                <h5> <% if u.received_reviews.present? %>
                      <i class="fas fa-star" style="color: #ffcd3c"></i>
                      <%= u.average_ratings %></h5>
                      <% else %>
                      <p>No ratings yet</p>
                      <% end %>
                <% u.teaching_subjects.each do |s| %>
                <div class="tag"><%= s.name %></div>
                <% end %>
                <p><%= u.bio %></p>
              </div>
            </div>
            <hr>
            <div class="card-extra-info">
              <p>
                <img src="https://image.flaticon.com/icons/svg/3068/3068550.svg" width="30" alt="">
                <%= u.language %>
              </p>
              <p><img src="https://image.flaticon.com/icons/svg/3014/3014764.svg" width="30" alt="">
                <%= u.location %>
              </p>
              <p><img src="https://image.flaticon.com/icons/svg/3094/3094812.svg" width="30" alt="">
                <%= u.received_reviews.count %>
              </p>
              <% if u.price.present? %>
<p>
                <img src="https://image.flaticon.com/icons/svg/3050/3050241.svg" width="30" alt="">
              <%= u.price %> euros / Hour
              </p>
              <% end %>


            </div>
          </div>
        </div>
        <% end %>
        <% end %>

    <div class="col-3 mx-auto">
      <%= will_paginate @users, renderer: WillPaginate::ActionView::BootstrapLinkRenderer %>
    </div>
  </div>

</div>
